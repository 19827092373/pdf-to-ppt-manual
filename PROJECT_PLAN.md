# PDF习题拆分PPT工具 - 项目计划

## 项目概述

本项目旨在为物理老师提供一个工具，将PDF格式的习题册转换为PPT格式，每页PPT包含一道题目，方便在多媒体大屏上进行讲解和书写。

## 核心需求

### 1. 功能需求
- **PDF上传**: 支持上传PDF文件
- **页面预览**: 将PDF每一页转换为图片并显示
- **手动选择**: 用户可以通过矩形框手动选择每道题目
- **矩形框调整**: 支持拖拽和缩放矩形框，精确定位题目区域
- **PPT生成**: 将选中的题目区域生成PPT，每页一题
- **图片布局**: 题目图片放置在PPT左上角，面积不超过页面一半

### 2. 界面需求
- 中文界面
- 直观易用的操作流程
- 实时预览功能

### 3. 技术约束
- 初始阶段不包含自动识别功能
- 完全依赖用户手动选择

## 技术架构

### 前端技术栈
- HTML5 + CSS3 + JavaScript (原生)
- Canvas API (用于图片显示和矩形框绘制)
- File API (文件上传)

### 后端技术栈
- Python Flask (轻量级Web框架)
- pdf2image (PDF转图片)
- Pillow (图片处理)
- python-pptx (PPT生成)

### 项目结构
```
pdf-to-ppt-manual/
├── app.py                 # Flask主应用
├── requirements.txt       # Python依赖
├── README.md             # 项目说明
├── PROJECT_PLAN.md       # 项目计划（本文件）
├── static/
│   ├── css/
│   │   └── style.css     # 样式文件
│   └── js/
│       └── main.js       # 前端逻辑
├── templates/
│   └── index.html        # 主页面
├── uploads/              # 上传文件目录
├── temp/                 # 临时文件目录
└── output/               # 输出PPT目录
```

## 功能模块设计

### 1. PDF处理模块
**文件**: `utils/pdf_handler.py`
- `pdf_to_images(pdf_path)`: 将PDF转换为图片列表
- `save_image(image, path)`: 保存图片到临时目录

### 2. 图片裁剪模块
**文件**: `utils/image_cropper.py`
- `crop_image(image_path, bbox)`: 根据边界框裁剪图片
- `resize_to_fit(image, max_width, max_height)`: 调整图片尺寸以适应PPT

### 3. PPT生成模块
**文件**: `utils/ppt_generator.py`
- `create_ppt(images, output_path)`: 创建PPT文件
- `add_slide_with_image(prs, image_path, position)`: 添加包含图片的幻灯片
- `calculate_image_position(image_size, slide_size)`: 计算图片在PPT中的位置

### 4. 前端交互模块
**文件**: `static/js/main.js`
- PDF上传处理
- Canvas图片显示
- 矩形框绘制和交互（拖拽、缩放）
- 题目区域选择管理
- 与后端API通信

## 详细实现计划

### 阶段一：基础框架搭建
1. ✅ 创建项目目录结构
2. ✅ 编写项目计划文档
3. 配置Flask应用基础结构
4. 创建前端页面框架

### 阶段二：PDF处理功能
1. 实现PDF上传接口
2. 实现PDF转图片功能
3. 前端显示PDF页面图片

### 阶段三：矩形框选择功能
1. 在Canvas上绘制矩形框
2. 实现矩形框拖拽功能
3. 实现矩形框缩放功能（四个角和四条边）
4. 实现多页面矩形框管理

### 阶段四：图片裁剪和PPT生成
1. 实现图片裁剪功能
2. 实现图片尺寸调整（确保不超过PPT页面一半）
3. 实现PPT生成功能
4. 实现PPT下载功能

### 阶段五：界面优化和测试
1. 优化界面布局和样式
2. 添加操作提示和帮助信息
3. 测试各种场景
4. 修复bug和优化性能

## 关键算法设计

### 1. 矩形框交互算法
- **拖拽**: 检测鼠标按下位置是否在矩形框内，移动时更新矩形框位置
- **缩放**: 检测鼠标按下位置是否在矩形框边缘或角落，移动时更新矩形框尺寸
- **边界限制**: 确保矩形框不超出图片边界

### 2. 图片尺寸调整算法
- PPT标准尺寸: 宽度10英寸，高度7.5英寸（16:9比例）
- 图片最大尺寸: 宽度5英寸，高度3.75英寸（页面一半）
- 保持图片宽高比
- 计算缩放比例: `scale = min(max_width/img_width, max_height/img_height, 0.5)`

### 3. PPT布局算法
- 图片位置: 左上角对齐
- 如果图片宽度超过页面一半，按比例缩小
- 如果图片高度超过页面一半，按比例缩小
- 保持图片原始宽高比

## 用户操作流程

1. **上传PDF**: 用户选择并上传PDF文件
2. **查看页面**: 系统显示PDF所有页面的缩略图
3. **选择页面**: 用户点击某个页面，显示大图
4. **绘制矩形框**: 用户在大图上绘制矩形框选择题目
5. **调整矩形框**: 用户拖拽或缩放矩形框，精确定位题目
6. **确认选择**: 用户确认当前页面的所有题目选择
7. **处理下一页**: 重复步骤3-6，直到所有页面处理完成
8. **生成PPT**: 点击生成按钮，系统生成PPT文件
9. **下载PPT**: 用户下载生成的PPT文件

## 界面设计要点

### 主界面布局
- **顶部**: 标题和上传按钮
- **左侧**: PDF页面缩略图列表（可滚动）
- **中间**: 当前页面大图显示区域（Canvas）
- **右侧**: 已选择题目列表和操作按钮
- **底部**: 生成PPT按钮和进度提示

### 交互反馈
- 鼠标悬停在矩形框上时显示调整手柄
- 选中矩形框时高亮显示
- 操作提示和错误提示
- 生成进度显示

## 技术难点和解决方案

### 难点1: Canvas矩形框交互
**解决方案**: 
- 使用Canvas的鼠标事件监听
- 实现碰撞检测算法判断鼠标位置
- 使用requestAnimationFrame优化绘制性能

### 难点2: 图片尺寸和位置计算
**解决方案**:
- 使用python-pptx的Inches单位进行精确计算
- 实现图片缩放算法保持宽高比
- 使用Pillow进行图片预处理

### 难点3: 多页面状态管理
**解决方案**:
- 使用JavaScript对象存储每页的选择状态
- 实现页面切换时状态保存和恢复

## 未来扩展方向（⚠️ 不在当前版本中实现）

**注意**：以下功能是未来可能添加的功能，当前版本**不包含**这些功能。当前版本完全依赖用户手动选择题目。

1. 自动识别题目区域（OCR + 图像处理）- **未实现**
2. 批量处理多个PDF文件 - **未实现**
3. 支持自定义PPT模板 - **未实现**
4. 支持题目编号识别和排序 - **未实现**
5. 支持题目类型分类（选择题、填空题、计算题等） - **未实现**

**当前版本功能**：
- ✅ PDF上传和预览
- ✅ 手动矩形框选择题目
- ✅ 矩形框拖拽和缩放调整
- ✅ PPT生成（每页一题）

## 开发时间估算

- 阶段一：基础框架搭建 - 1小时
- 阶段二：PDF处理功能 - 2小时
- 阶段三：矩形框选择功能 - 4小时
- 阶段四：图片裁剪和PPT生成 - 3小时
- 阶段五：界面优化和测试 - 2小时

**总计**: 约12小时

## 依赖库清单

### Python依赖
```
Flask==3.0.0
pdf2image==1.16.3
Pillow==10.1.0
python-pptx==0.6.23
```

### 系统依赖
- poppler (PDF处理工具，pdf2image需要)

## 注意事项

1. 确保系统安装了poppler工具
2. 临时文件需要定期清理
3. 大文件上传需要设置合理的文件大小限制
4. 考虑并发访问时的文件命名冲突问题

