# 部署到云服务器指南

## 前置要求

1. 云服务器（Linux系统，推荐Ubuntu 20.04+）
2. 域名（可选）
3. SSH访问权限

## 部署步骤

### 1. 上传文件到服务器

```bash
# 使用scp上传
scp -r pdf-to-ppt-manual user@your-server.com:/opt/

# 或使用git
git clone your-repo-url
```

### 2. 安装依赖

```bash
# 更新系统
sudo apt update
sudo apt upgrade -y

# 安装Python和pip
sudo apt install python3 python3-pip -y

# 安装项目依赖
cd /opt/pdf-to-ppt-manual
pip3 install -r requirements.txt

# 安装PyMuPDF（推荐，无需poppler）
pip3 install PyMuPDF

# 或安装poppler（如果使用pdf2image）
sudo apt install poppler-utils -y
```

### 3. 安装Gunicorn

```bash
pip3 install gunicorn
```

### 4. 创建systemd服务

创建文件 `/etc/systemd/system/pdf-to-ppt.service`:

```ini
[Unit]
Description=PDF习题拆分PPT工具
After=network.target

[Service]
Type=simple
User=www-data
WorkingDirectory=/opt/pdf-to-ppt-manual
Environment="PATH=/usr/bin:/usr/local/bin"
ExecStart=/usr/local/bin/gunicorn -w 4 -b 0.0.0.0:5000 app:app
Restart=always

[Install]
WantedBy=multi-user.target
```

### 5. 启动服务

```bash
sudo systemctl daemon-reload
sudo systemctl enable pdf-to-ppt
sudo systemctl start pdf-to-ppt
sudo systemctl status pdf-to-ppt
```

### 6. 配置Nginx（可选）

创建文件 `/etc/nginx/sites-available/pdf-to-ppt`:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    location /static {
        alias /opt/pdf-to-ppt-manual/static;
    }
}
```

启用配置：

```bash
sudo ln -s /etc/nginx/sites-available/pdf-to-ppt /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 7. 配置防火墙

```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 5000/tcp
sudo ufw enable
```

### 8. 配置SSL（可选，使用Let's Encrypt）

```bash
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d your-domain.com
```

## 维护命令

```bash
# 查看日志
sudo journalctl -u pdf-to-ppt -f

# 重启服务
sudo systemctl restart pdf-to-ppt

# 停止服务
sudo systemctl stop pdf-to-ppt

# 查看状态
sudo systemctl status pdf-to-ppt
```

## 注意事项

1. 确保上传和临时目录有写权限
2. 定期清理temp和output目录
3. 配置日志轮转避免日志文件过大
4. 考虑使用supervisor或pm2管理进程

